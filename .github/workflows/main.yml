name: Build Revit Addin (.NET 8)

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: ğŸ§¾ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§© Setup .NET 8 SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      # â¬‡ï¸ Download and extract Revit API DLLs from release (must be Revit 2025 versions)
      - name: ğŸ“¦ Download and extract Revit API DLLs
        shell: pwsh
        run: |
          $ErrorActionPreference = "Stop"
          $url = "https://github.com/SHarpreet89/MyRevitAddin/releases/download/v1.0.1/RevitApis.zip"
          Write-Host "ğŸ“¥ Downloading from $url..."
          curl -L -o RevitApis.zip $url

          $size = (Get-Item RevitApis.zip).Length
          if ($size -lt 10000) { throw "âŒ Download too small - check release asset" }

          Write-Host "ğŸ“‚ Extracting..."
          7z x RevitApis.zip -y -o.

          Write-Host "âœ… Extracted RevitAPI files:"
          Get-ChildItem -Filter "RevitAPI*.dll" | ForEach-Object { Write-Host $_.FullName }

      - name: ğŸ—ï¸ Build Revit Addin
        run: dotnet build MyRevitAddin.csproj --configuration Release

      - name: ğŸ“¤ Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: MyRevitAddin
          path: bin/Release/net8.0-windows/
